<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Interacting with IOS XE and IOS XR using Netmiko - Technology Blog Wim</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	
	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">
	<link rel="shortcut icon" href="/favicon.ico">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-83351442-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Technology Blog Wim" rel="home">
				<img src="/img/logo_blog.png" alt="Logo" />
				
			</a>
		</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/networkprogrammability">
				
				<span class="menu__text">Network Programmability</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/devops">
				
				<span class="menu__text">DevOps</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/webdevelopment">
				
				<span class="menu__text">Web Development</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/categories/public-cloud">
				
				<span class="menu__text">Cloud</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/categories/cloud-native/">
				
				<span class="menu__text">Cloud-Native</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about">
				
				<span class="menu__text">About Me</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Interacting with IOS XE and IOS XR using Netmiko</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>
	<time class="meta__text" datetime="2020-03-25T12:32:50&#43;01:00">March 25, 2020</time>
</div>
</div>
		</header><div class="content post__content clearfix">
			<h3 id="what-is-netmiko">What is Netmiko</h3>
<p>Netmiko is a multi-vendor SSH Python library which makes connecting to network devices via SSH really easy and straightforward. The library  simplifies SSH management to network devices is based on the Paramiko SSH library.</p>
<p>As per the documentation, the purposes of this library are the following:</p>
<ul>
<li>Successfully establish an SSH connection to the device</li>
<li>Simplify the execution of show commands and the retrieval of output data</li>
<li>Simplify execution of configuration commands including possibly commit actions</li>
<li>Do the above across a broad set of networking vendors and platforms</li>
</ul>
<h3 id="why-netmiko">Why Netmiko</h3>
<p>The question is: if we have Paramiko, why would be need something like Netmiko. As it turns out, Paramiko can sometimes be quite hard to work with. Netmiko is hiding many details of common devive communication. It uses Paramiko for the underlying SSH connectivity, but provides a higher abstraction for the communication with networking devices.</p>
<p>From the creator of Netmiko Kirk Byers:</p>
<blockquote>
<p>At the time, I had observed that many individuals encountered similar issues with Python-SSH and network devices.</p>
</blockquote>
<p>In this post, we have largely used similar use cases as the ones we described in the Paramiko related posts.</p>
<h3 id="installing-netmiko">Installing Netmiko</h3>
<pre><code>WAUTERW-M-65P7:Netmiko_Introduction wauterw$ python3 -m venv venv
WAUTERW-M-65P7:Netmiko_Introduction wauterw$ source venv/bin/activate
(venv) WAUTERW-M-65P7:Netmiko_Introduction wauterw$ pip3 install netmiko
Collecting netmiko
***Truncated***
Installing collected packages: pycparser, cffi, pynacl, bcrypt, cryptography, paramiko, scp, pyserial, future, textfsm, netmiko
  Running setup.py install for future ... done
Successfully installed bcrypt-3.1.7 cffi-1.14.0 cryptography-2.8 future-0.18.2 netmiko-3.1.0 paramiko-2.7.1 pycparser-2.20 pynacl-1.3.0 pyserial-3.4 scp-0.13.2 textfsm-1.1.0
</code></pre><h3 id="note-about-equipment">Note about equipment</h3>
<p>For all the examples, we will use a Cisco sandbox environment delivered by <a href="https://developer.cisco.com">Cisco Devnet</a>. Go check out Devnet, really brilliant. To get a list of all sandboxes, check out <a href="https://devnetsandbox.cisco.com/">this</a> link. For this tutorial, I&rsquo;m using the IOS XE sandbox (see <a href="https://devnetsandbox.cisco.com/RM/Diagram/Index/38ded1f0-16ce-43f2-8df5-43a40ebf752e?diagramType=Topology">here</a>) and the IOS XR sandbox (see <a href="https://devnetsandbox.cisco.com/RM/Diagram/Index/e83cfd31-ade3-4e15-91d6-3118b867a0dd?diagramType=Topology">here</a>).</p>
<h3 id="use-case-retrieve-device-uptimes">Use case: retrieve device uptimes</h3>
<p>Let&rsquo;s start with an easy example: we will write a Python script that interacts with an IOS XE device and returns the uptime of the router.</p>
<p>We store both devices (IOS XE and IOS XR) in a list of dictionaries (key:value pairs). It allows up to loop over the devices list and execute the command for each device.</p>
<p>Within the for-loop, we first make a connection via Netmiko&rsquo;s connection method (called Netmiko). This is also the reason why we import the Netmiko library at the top of the script. See <a href="https://github.com/ktbyers/netmiko/blob/develop/examples/use_cases/case2_using_dict/conn_with_dict.py">here</a> an example from Kirk Byers.</p>
<p>Executing commands is really easy. All we need to do is pass the command we want to execute to the <code>send_command</code> method and capture the output.</p>
<p>Important note: The ConnectHandler class is identical to the Netmiko class. This means that we can also use the ConnectHandler. If you would like to do so then couple of things would change:</p>
<ul>
<li>the <code>net_connect = Netmiko(**device)</code> would become <code>net_connect = ConnectHandler(**device)</code></li>
<li>import the ConnectHandler library. <code>from netmiko import Netmiko</code> would become <code>from netmiko import ConnectHandler</code>.</li>
</ul>
<p>In the below example, we will simply use the Netmiko method.</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000;font-weight:bold">from</span> <span style="color:#00f;font-weight:bold">netmiko</span> <span style="color:#008000;font-weight:bold">import</span> Netmiko

devices <span style="color:#666">=</span> [{
    <span style="color:#ba2121">&#34;device_type&#34;</span>: <span style="color:#ba2121">&#34;cisco_xr&#34;</span>,
    <span style="color:#ba2121">&#34;ip&#34;</span>: <span style="color:#ba2121">&#34;sbx-iosxr-mgmt.cisco.com&#34;</span>,
    <span style="color:#ba2121">&#34;username&#34;</span>: <span style="color:#ba2121">&#34;admin&#34;</span>,
    <span style="color:#ba2121">&#34;password&#34;</span>: <span style="color:#ba2121">&#34;C1sco12345&#34;</span>,
    <span style="color:#ba2121">&#34;port&#34;</span>: <span style="color:#ba2121">&#34;8181&#34;</span>,
}, {
    <span style="color:#ba2121">&#34;device_type&#34;</span>: <span style="color:#ba2121">&#34;cisco_xe&#34;</span>,
    <span style="color:#ba2121">&#34;ip&#34;</span>: <span style="color:#ba2121">&#34;ios-xe-mgmt-latest.cisco.com&#34;</span>,
    <span style="color:#ba2121">&#34;username&#34;</span>: <span style="color:#ba2121">&#34;developer&#34;</span>,
    <span style="color:#ba2121">&#34;password&#34;</span>: <span style="color:#ba2121">&#34;C1sco12345&#34;</span>,
    <span style="color:#ba2121">&#34;port&#34;</span>: <span style="color:#ba2121">&#34;8181&#34;</span>,
}]

<span style="color:#008000;font-weight:bold">for</span> device <span style="color:#a2f;font-weight:bold">in</span> devices:
    net_connect <span style="color:#666">=</span> Netmiko(<span style="color:#666">**</span>device)
    output <span style="color:#666">=</span> net_connect<span style="color:#666">.</span>send_command(<span style="color:#ba2121">&#34;show version&#34;</span>)
    net_connect<span style="color:#666">.</span>disconnect()
    result <span style="color:#666">=</span> output<span style="color:#666">.</span>find(<span style="color:#ba2121">&#39;uptime is&#39;</span>)
    begin <span style="color:#666">=</span> <span style="color:#008000">int</span>(result)
    end <span style="color:#666">=</span> begin <span style="color:#666">+</span> <span style="color:#666">38</span>
    <span style="color:#008000;font-weight:bold">print</span>(device[<span style="color:#ba2121">&#39;ip&#39;</span>] <span style="color:#666">+</span> <span style="color:#ba2121">&#34; =&gt; &#34;</span> <span style="color:#666">+</span> output[<span style="color:#008000">int</span>(begin):<span style="color:#008000">int</span>(end)])
</code></pre></div><p>In the Github repo, the above script can be found <a href="https://github.com/wiwa1978/blog-hugo-netlify-code/blob/master/Netmiko_Introduction/show_uptime.py">here</a>. Another simple and straightforward example can be found <a href="https://github.com/wiwa1978/blog-hugo-netlify-code/blob/master/Netmiko_Introduction/show_ip_int_brief.py">here</a>. It&rsquo;s a small variant on the above script and retrieves an overview of all interfaces on both devices.</p>
<h3 id="use-case-set-interface-description">Use case: Set interface description</h3>
<p>In the previous use case, we have shown an example to execute some simple &ldquo;show&rdquo; commands, in other words to <code>read</code> information from the device. In this use case, we want also to give an example on how to <code>write</code> information to the devices.</p>
<p>We will essentially change the interface description of a particular port. It follows the same approach as the previous example. We store the devices in a list of dictionaries and we loop over them in a for-loop. Inside the for-loop, we use the <code>send_config_set</code> method (see documentation <a href="https://ktbyers.github.io/netmiko/docs/netmiko/index.html">here</a>). At a minimum, we need to pass the config_commands, which is an iterable contain all of the configuration commands. Hence, we have created a list called <code>description_config</code> which contains a list of all the commands we want to execute (in order).</p>
<p>Important to understand is that NetMiko will already bring you in the <code>conf t</code> state. Next, we will go into &lsquo;interface GigabitEthernet3&rsquo; and then set the description.</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000;font-weight:bold">from</span> <span style="color:#00f;font-weight:bold">netmiko</span> <span style="color:#008000;font-weight:bold">import</span> ConnectHandler

devices <span style="color:#666">=</span> [{
   <span style="color:#ba2121">&#34;device_type&#34;</span>: <span style="color:#ba2121">&#34;cisco_xe&#34;</span>,
   <span style="color:#ba2121">&#34;ip&#34;</span>: <span style="color:#ba2121">&#34;ios-xe-mgmt-latest.cisco.com&#34;</span>,
   <span style="color:#ba2121">&#34;username&#34;</span>: <span style="color:#ba2121">&#34;developer&#34;</span>,
   <span style="color:#ba2121">&#34;password&#34;</span>: <span style="color:#ba2121">&#34;C1sco12345&#34;</span>,
   <span style="color:#ba2121">&#34;port&#34;</span>: <span style="color:#ba2121">&#34;8181&#34;</span>,
}]

description <span style="color:#666">=</span> <span style="color:#ba2121">&#39;Description set with Netmiko&#39;</span>

description_config <span style="color:#666">=</span> [
    <span style="color:#ba2121">&#34;interface GigabitEthernet3&#34;</span>,
    f<span style="color:#ba2121">&#34;description {description}&#34;</span>,
]

<span style="color:#008000;font-weight:bold">for</span> device <span style="color:#a2f;font-weight:bold">in</span> devices:
   net_connect <span style="color:#666">=</span> ConnectHandler(<span style="color:#666">**</span>device)
   output <span style="color:#666">=</span> net_connect<span style="color:#666">.</span>send_config_set(description_config)
   <span style="color:#008000;font-weight:bold">print</span>(output)
   net_connect<span style="color:#666">.</span>disconnect()
</code></pre></div><p>Before executing this script, let&rsquo;s check the interface descriptions (pay attention to &lsquo;Gi3&rsquo;) by just logging into the device using a terminal.</p>
<p><img src="/images/2020-03-25-1.png" alt="interface"></p>
<p>Let&rsquo;s now execute our Python script.</p>
<p><img src="/images/2020-03-25-2.png" alt="interface"></p>
<p>And then let&rsquo;s check again by logging into the device via our terminal. You will notice that indeed the interface description has been changed to the string we used in our little script.</p>
<p><img src="/images/2020-03-25-3.png" alt="interface"></p>
<h3 id="use-case-variant-to-set-interface-description">Use case: Variant to &lsquo;Set interface description&rsquo;</h3>
<p>In the previous use case, we have read the various commands from a list we declared in our Python script. Netmiko also supports a method (<code>send_config_from_file</code> method) to read these commands from a file. It&rsquo;s pretty similar to the script we used in previous use case.</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000;font-weight:bold">from</span> <span style="color:#00f;font-weight:bold">netmiko</span> <span style="color:#008000;font-weight:bold">import</span> ConnectHandler
<span style="color:#008000;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">logging</span>

devices <span style="color:#666">=</span> [{
   <span style="color:#ba2121">&#34;device_type&#34;</span>: <span style="color:#ba2121">&#34;cisco_xe&#34;</span>,
   <span style="color:#ba2121">&#34;ip&#34;</span>: <span style="color:#ba2121">&#34;ios-xe-mgmt-latest.cisco.com&#34;</span>,
   <span style="color:#ba2121">&#34;username&#34;</span>: <span style="color:#ba2121">&#34;developer&#34;</span>,
   <span style="color:#ba2121">&#34;password&#34;</span>: <span style="color:#ba2121">&#34;C1sco12345&#34;</span>,
   <span style="color:#ba2121">&#34;port&#34;</span>: <span style="color:#ba2121">&#34;8181&#34;</span>,
}]

<span style="color:#008000;font-weight:bold">for</span> device <span style="color:#a2f;font-weight:bold">in</span> devices:
   net_connect <span style="color:#666">=</span> ConnectHandler(<span style="color:#666">**</span>device)
   output <span style="color:#666">=</span> net_connect<span style="color:#666">.</span>send_config_from_file(<span style="color:#ba2121">&#39;changes.txt&#39;</span>)
   <span style="color:#008000;font-weight:bold">print</span>(output)
   net_connect<span style="color:#666">.</span>disconnect()
</code></pre></div><p>As you can see, the commands are read from the changes.txt file. See below the contents of that file:</p>
<pre><code># Changes.txt
interface GigabitEthernet3
description This is set via Netmiko and text file
</code></pre><p>Let&rsquo;s execute the script:
<img src="/images/2020-03-25-4.png" alt="interface"></p>
<p>And verify if things got changed indeed:</p>
<p><img src="/images/2020-03-25-5.png" alt="interface"></p>
<h3 id="use-case-add-loopback-interfaces">Use case: Add Loopback interfaces</h3>
<p>In this use case, we will use some things we learned in previous posts. We will do the following:</p>
<ul>
<li>read device information from a YML file</li>
<li>read variables (containing loopback information) from a YML file</li>
<li>Use Jinja2 template</li>
<li>Use Netmiko to configure the loopback interfaces</li>
</ul>
<p>In case some of this is new, I recommend you to have a look at the following blog posts:</p>
<ul>
<li>Parsing YML file: see <a href="https://blog.wimwauters.com/networkprogrammability/2020-01-14-parse_yaml_python/">here</a></li>
<li>Working with Jinja2: see <a href="https://blog.wimwauters.com/networkprogrammability/2020-02-27-aci_python_requests_jinja_part1/">here</a></li>
</ul>
<p>Let&rsquo;s have a look at the YML file first:</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#008000;font-weight:bold">interfaces</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>Loopback2001<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">description</span>:<span style="color:#bbb"> </span>Description<span style="color:#bbb"> </span>for<span style="color:#bbb"> </span>Loopback<span style="color:#bbb"> </span><span style="color:#666">2000</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">ipv4_addr</span>:<span style="color:#bbb"> </span><span style="color:#666">200.200.200.200</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">ipv4_mask</span>:<span style="color:#bbb"> </span><span style="color:#666">255.255.255.255</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb">  </span>Loopback2002<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">description</span>:<span style="color:#bbb"> </span>Description<span style="color:#bbb"> </span>for<span style="color:#bbb"> </span>Loopback<span style="color:#bbb"> </span><span style="color:#666">2001</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">ipv4_addr</span>:<span style="color:#bbb"> </span><span style="color:#666">200.200.200.201</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">ipv4_mask</span>:<span style="color:#bbb"> </span><span style="color:#666">255.255.255.255</span><span style="color:#bbb">
</span></code></pre></div><p>As mentioned, this file contains the required information to configure the loopback interfaces. We will also read the host information from a file called hosts.yml.</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#408080;font-style:italic"># Define list of hosts</span><span style="color:#bbb">
</span><span style="color:#bbb"></span>---<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">hosts</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>sbx-iosxr-mgmt.cisco.com<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">username</span>:<span style="color:#bbb"> </span>admin<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">password</span>:<span style="color:#bbb"> </span>C1sco12345<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">port</span>:<span style="color:#bbb"> </span><span style="color:#666">8181</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">cmd</span>:<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;show running-config&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">type</span>:<span style="color:#bbb"> </span>cisco_xr<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>ios-xe-mgmt-latest.cisco.com<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">username</span>:<span style="color:#bbb"> </span>developer<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">password</span>:<span style="color:#bbb"> </span>C1sco12345<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">port</span>:<span style="color:#bbb"> </span><span style="color:#666">8181</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">cmd</span>:<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;show running-config&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">type</span>:<span style="color:#bbb"> </span>cisco_xe<span style="color:#bbb">
</span></code></pre></div><p>The Jinja2 file is relative straightforward as well. Essentially, we use a for loop to iterate over the loopback interfaces. Each time, we use the data that is passed to this template from the Python file.</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-jinja" data-lang="jinja"><span style="color:#bc7a00">{%</span> <span style="color:#008000;font-weight:bold">for</span> <span style="color:#19177c">interface</span> <span style="color:#008000;font-weight:bold">in</span> <span style="color:#19177c">data.interfaces</span> <span style="color:#bc7a00">%}</span>
interface <span style="color:#bc7a00">{{</span><span style="color:#19177c">interface.name</span><span style="color:#bc7a00">}}</span>
description <span style="color:#bc7a00">{{</span><span style="color:#19177c">interface.description</span><span style="color:#bc7a00">}}</span>
 ip address <span style="color:#bc7a00">{{</span><span style="color:#19177c">interface.ipv4_addr</span><span style="color:#bc7a00">}}</span> <span style="color:#bc7a00">{{</span><span style="color:#19177c">interface.ipv4_mask</span><span style="color:#bc7a00">}}</span>
<span style="color:#bc7a00">{%</span> <span style="color:#008000;font-weight:bold">endfor</span> <span style="color:#bc7a00">%}</span>
</code></pre></div><p>The Python file is first reading in the host information from the hosts.yml file. The interface information we read from the YML file. The host and interface information is now available to us in a Python dictionary.</p>
<p>Next, we use the Jinja2 library to render the template with the variables. The end result of this is that <code>loopback_config</code> contains the completed (absolute) file with all loopback information.</p>
<p>Next, we simply loop over the devices (hosts) and for each host we create an SSH connection via Netmiko. And finally we use the <code>send_config_set</code> method to which we pass the loopback_config information (which contains nothing more than the commands to configure a loopback interface).</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#008000;font-weight:bold">import</span> <span style="color:#00f;font-weight:bold">yaml</span>
<span style="color:#008000;font-weight:bold">from</span> <span style="color:#00f;font-weight:bold">netmiko</span> <span style="color:#008000;font-weight:bold">import</span> Netmiko
<span style="color:#008000;font-weight:bold">from</span> <span style="color:#00f;font-weight:bold">jinja2</span> <span style="color:#008000;font-weight:bold">import</span> Environment, FileSystemLoader

hosts <span style="color:#666">=</span> yaml<span style="color:#666">.</span>load(<span style="color:#008000">open</span>(<span style="color:#ba2121">&#39;hosts.yml&#39;</span>), Loader<span style="color:#666">=</span>yaml<span style="color:#666">.</span>SafeLoader)
interfaces <span style="color:#666">=</span> yaml<span style="color:#666">.</span>load(<span style="color:#008000">open</span>(<span style="color:#ba2121">&#39;loopback.yml&#39;</span>), Loader<span style="color:#666">=</span>yaml<span style="color:#666">.</span>SafeLoader)

env <span style="color:#666">=</span> Environment(loader <span style="color:#666">=</span> FileSystemLoader(<span style="color:#ba2121">&#39;.&#39;</span>), trim_blocks<span style="color:#666">=</span>True, autoescape<span style="color:#666">=</span>True)
template <span style="color:#666">=</span> env<span style="color:#666">.</span>get_template(<span style="color:#ba2121">&#39;loopback.j2&#39;</span>)
loopback_config <span style="color:#666">=</span> template<span style="color:#666">.</span>render(data<span style="color:#666">=</span>interfaces)

<span style="color:#008000;font-weight:bold">for</span> host <span style="color:#a2f;font-weight:bold">in</span> hosts[<span style="color:#ba2121">&#34;hosts&#34;</span>]:
   net_connect <span style="color:#666">=</span> Netmiko(
      host <span style="color:#666">=</span> host[<span style="color:#ba2121">&#34;name&#34;</span>],
      username <span style="color:#666">=</span> host[<span style="color:#ba2121">&#34;username&#34;</span>],
      password <span style="color:#666">=</span> host[<span style="color:#ba2121">&#34;password&#34;</span>],
      port <span style="color:#666">=</span> host[<span style="color:#ba2121">&#34;port&#34;</span>],
      device_type <span style="color:#666">=</span> host[<span style="color:#ba2121">&#34;type&#34;</span>]
   )
   <span style="color:#008000;font-weight:bold">print</span>(f<span style="color:#ba2121">&#34;Logged into {host[&#39;name&#39;]} successfully&#34;</span>)
   output <span style="color:#666">=</span> net_connect<span style="color:#666">.</span>send_config_set(loopback_config<span style="color:#666">.</span>split(<span style="color:#ba2121">&#34;</span><span style="color:#b62;font-weight:bold">\n</span><span style="color:#ba2121">&#34;</span>))
</code></pre></div><p>Let&rsquo;s run this example.</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#666">(</span>base<span style="color:#666">)</span> WAUTERW-M-65P7:test wauterw$ python3 script.py 
***Truncated***
Logged into ios-xe-mgmt-latest.cisco.com successfully
config term
Enter configuration commands, one per line.  End with CNTL/Z.
csr1000v-1<span style="color:#666">(</span>config<span style="color:#666">)</span><span style="color:#408080;font-style:italic">#interface Loopback3001</span>
csr1000v-1<span style="color:#666">(</span>config-if<span style="color:#666">)</span><span style="color:#408080;font-style:italic">#description Description for Loopback 3001</span>
csr1000v-1<span style="color:#666">(</span>config-if<span style="color:#666">)</span><span style="color:#408080;font-style:italic"># ip address 200.200.200.230 255.255.255.255</span>
csr1000v-1<span style="color:#666">(</span>config-if<span style="color:#666">)</span><span style="color:#408080;font-style:italic">#interface Loopback3002</span>
csr1000v-1<span style="color:#666">(</span>config-if<span style="color:#666">)</span><span style="color:#408080;font-style:italic">#description Description for Loopback 3002</span>
csr1000v-1<span style="color:#666">(</span>config-if<span style="color:#666">)</span><span style="color:#408080;font-style:italic"># ip address 200.200.200.231 255.255.255.255</span>
csr1000v-1<span style="color:#666">(</span>config-if<span style="color:#666">)</span>#
csr1000v-1<span style="color:#666">(</span>config-if<span style="color:#666">)</span><span style="color:#408080;font-style:italic">#end</span>
</code></pre></div><p>To see if the interfaces were correctly added, we can use a script we mentioned earlier in this blogpost, e.g <a href="https://github.com/wiwa1978/blog-hugo-netlify-code/blob/master/Netmiko_Introduction/show_ip_int_brief.py">this</a> one.</p>
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Interface              IP-Address      OK? Method Status                Protocol
GigabitEthernet1       10.10.20.48     YES other  up                    up      
GigabitEthernet2       10.121.23.120   YES other  up                    up      
GigabitEthernet2.4     unassigned      YES manual deleted               down    
***Truncated***     
Loopback3001           200.200.200.230 YES manual up                    up      
Loopback3002           200.200.200.231 YES manual up                    up      
Port-channel1          unassigned      YES <span style="color:#008000">unset</span>  down                  down    
VirtualPortGroup0      10.10.20.48     YES <span style="color:#008000">unset</span>  up                    up   
</code></pre></div><p>This particular example can be found <a href="https://github.com/wiwa1978/blog-hugo-netlify-code/tree/master/Netmiko_Introduction/loopback">here</a>.</p>
<p>That&rsquo;s it for this post. Hope you liked this little introduction to Netmiko. To have a view on all examples discussed in this post, you can check out the Github repo <a href="https://github.com/wiwa1978/blog-hugo-netlify-code/tree/master/Netmiko_Introduction">here</a>.</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="/tags/ios-xe/" rel="tag">IOS XE</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/ios-xr/" rel="tag">IOS XR</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/python/" rel="tag">Python</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/netmiko/" rel="tag">Netmiko</a></li>
	</ul>
</div>
		</footer>
	</article>
</main>


<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/networkprogrammability/2020-03-24-paramiko_introduction_part2/" rel="prev"><span class="post-nav__caption">«&thinsp;Previous</span><p class="post-nav__post-title">Interacting with IOS XE using Paramiko (part 2)</p></a>
	</div>
	<div class="post-nav__item post-nav__item--next">
		<a class="post-nav__link" href="/networkprogrammability/2020-03-30-netconf_python_part1/" rel="next"><span class="post-nav__caption">Next&thinsp;»</span><p class="post-nav__post-title">NETCONF/YANG and Python - part 1</p></a>
	</div>
</nav>

<section class="comments">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "blog-wimwauters" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


			</div>
			<aside class="sidebar">
<div class="widget-recent widget">
	<h4 class="widget__title">Recent Posts</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/networkprogrammability/2020-04-17_netpalm_introduction_part3/">NetPalm Introduction - Part 3</a></li>
			<li class="widget__item"><a class="widget__link" href="/networkprogrammability/2020-04-15_netpalm_introduction_part2/">NetPalm Introduction - Part 2</a></li>
			<li class="widget__item"><a class="widget__link" href="/networkprogrammability/2020-04-14_netpalm_introduction_part1/">NetPalm Introduction - Part 1</a></li>
			<li class="widget__item"><a class="widget__link" href="/networkprogrammability/2020-04-09_scrapli_introduction/">Scrapli Introduction</a></li>
			<li class="widget__item"><a class="widget__link" href="/networkprogrammability/2020-04-07_napalm_introduction_part2/">NAPALM Introduction - Part 2</a></li>
			<li class="widget__item"><a class="widget__link" href="/networkprogrammability/2020-04-06_napalm_introduction_part1/">NAPALM Introduction - Part 1</a></li>
			<li class="widget__item"><a class="widget__link" href="/networkprogrammability/2020-04-03_restconf_introduction_part2/">RESTCONF intro with Postman - Part 2</a></li>
			<li class="widget__item"><a class="widget__link" href="/networkprogrammability/2020-04-02_restconf_introduction_part1/">RESTCONF intro with Postman - Part 1</a></li>
			<li class="widget__item"><a class="widget__link" href="/networkprogrammability/2020-03-31_netconf_python_part2/">NETCONF/YANG and Python - part 2</a></li>
			<li class="widget__item"><a class="widget__link" href="/networkprogrammability/2020-03-30-netconf_python_part1/">NETCONF/YANG and Python - part 1</a></li>
		</ul>
	</div>
</div>
<div class="widget-categories widget">
	<h4 class="widget__title">Categories</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item">
				<a class="widget__link" href="/categories/backend/">Backend</a>
			</li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/cloud-native/">Cloud Native</a>
			</li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/continuous-integration/deployment/">Continuous Integration/Deployment</a>
			</li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/devops/">DevOps</a>
			</li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/infrastructure-as-code/">Infrastructure As Code</a>
			</li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/network-programming/">Network Programming</a>
			</li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/private-cloud/">Private Cloud</a>
			</li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/programming/">Programming</a>
			</li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/public-cloud/">Public Cloud</a>
			</li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/web-development/">Web Development</a>
			</li>
		</ul>
	</div>
</div>
<div class="widget-taglist widget">
	<h4 class="widget__title">Tags</h4>
	<div class="widget__content">
		<a class="widget-taglist__link widget__link btn" href="/tags/aci/" title="ACI">ACI (6)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/ansible/" title="Ansible">Ansible (3)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/aws/" title="AWS">AWS (4)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/digitalocean/" title="DigitalOcean">DigitalOcean (2)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/express/" title="Express">Express (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/gitlab/" title="Gitlab">Gitlab (2)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/ios-xe/" title="IOS XE">IOS XE (7)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/ios-xr/" title="IOS XR">IOS XR (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/jinja2/" title="Jinja2">Jinja2 (2)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/kubernetes/" title="Kubernetes">Kubernetes (3)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/mean/" title="MEAN">MEAN (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/mongo/" title="Mongo">Mongo (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/napalm/" title="Napalm">Napalm (2)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/netconf/" title="NETCONF">NETCONF (2)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/netmiko/" title="Netmiko">Netmiko (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/netpalm/" title="NetPalm">NetPalm (3)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/paramiko/" title="Paramiko">Paramiko (2)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/python/" title="Python">Python (16)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/restconf/" title="RESTCONF">RESTCONF (2)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/scrapli/" title="Scrapli">Scrapli (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/terraform/" title="Terraform">Terraform (11)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/vsphere/" title="vSphere">vSphere (3)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/xml/" title="XML">XML (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/yaml/" title="YAML">YAML (1)</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/yang/" title="YANG">YANG (4)</a>
	</div>
</div>
<div class="widget-social widget">
	<h4 class="widget-social__title widget__title">Social</h4>
	<div class="widget-social__content widget__content">
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="Twitter" rel="noopener noreferrer" href="https://twitter.com/@Wauters_Wim" target="_blank">
				<svg class="widget-social__link-icon icon icon-twitter" width="24" height="24" viewBox="0 0 384 312"><path d="m384 36.9c-14.1 6.3-29.3 10.5-45.2 12.4 16.3-9.7 28.8-25.2 34.6-43.6-15.2 9-32.1 15.6-50 19.1-14.4-15.2-34.9-24.8-57.5-24.8-43.5 0-78.8 35.3-78.8 78.8 0 6.2.7 12.2 2 17.9-65.5-3.3-123.5-34.6-162.4-82.3-6.7 11.6-10.6 25.2-10.6 39.6 0 27.3 13.9 51.4 35 65.6-12.9-.4-25.1-4-35.7-9.9v1c0 38.2 27.2 70 63.2 77.2-6.6 1.8-13.6 2.8-20.8 2.8-5.1 0-10-.5-14.8-1.4 10 31.3 39.1 54.1 73.6 54.7-27 21.1-60.9 33.7-97.8 33.7-6.4 0-12.6-.4-18.8-1.1 34.9 22.4 76.3 35.4 120.8 35.4 144.9 0 224.1-120 224.1-224.1 0-3.4-.1-6.8-.2-10.2 15.4-11.1 28.7-25 39.3-40.8z"/></svg>
				<span>Twitter</span>
			</a>
		</div>
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="LinkedIn" rel="noopener noreferrer" href="https://linkedin.com/in/https://www.linkedin.com/in/wim-wauters-92ab401" target="_blank">
				<svg class="widget-social__link-icon icon icon-linkedin" width="24" height="24" viewBox="0 0 352 352"><path d="M0,40v272c0,21.9,18.1,40,40,40h272c21.9,0,40-18.1,40-40V40c0-21.9-18.1-40-40-40H40C18.1,0,0,18.1,0,40z M312,32 c4.6,0,8,3.4,8,8v272c0,4.6-3.4,8-8,8H40c-4.6,0-8-3.4-8-8V40c0-4.6,3.4-8,8-8H312z M59.5,87c0,15.2,12.3,27.5,27.5,27.5 c15.2,0,27.5-12.3,27.5-27.5c0-15.2-12.3-27.5-27.5-27.5C71.8,59.5,59.5,71.8,59.5,87z M187,157h-1v-21h-45v152h47v-75 c0-19.8,3.9-39,28.5-39c24.2,0,24.5,22.4,24.5,40v74h47v-83.5c0-40.9-8.7-72-56.5-72C208.5,132.5,193.3,145.1,187,157z M64,288h47.5 V136H64V288z"/></svg>
				<span>LinkedIn</span>
			</a>
		</div>
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="GitHub" rel="noopener noreferrer" href="https://github.com/https://github.com/wiwa1978" target="_blank">
				<svg class="widget-social__link-icon icon icon-github" width="24" height="24" viewBox="0 0 384 374"><path d="m192 0c-106.1 0-192 85.8-192 191.7 0 84.7 55 156.6 131.3 181.9 9.6 1.8 13.1-4.2 13.1-9.2 0-4.6-.2-16.6-.3-32.6-53.4 11.6-64.7-25.7-64.7-25.7-8.7-22.1-21.3-28-21.3-28-17.4-11.9 1.3-11.6 1.3-11.6 19.3 1.4 29.4 19.8 29.4 19.8 17.1 29.3 44.9 20.8 55.9 15.9 1.7-12.4 6.7-20.8 12.2-25.6-42.6-4.8-87.5-21.3-87.5-94.8 0-20.9 7.5-38 19.8-51.4-2-4.9-8.6-24.3 1.9-50.7 0 0 16.1-5.2 52.8 19.7 15.3-4.2 31.7-6.4 48.1-6.5 16.3.1 32.7 2.2 48.1 6.5 36.7-24.8 52.8-19.7 52.8-19.7 10.5 26.4 3.9 45.9 1.9 50.7 12.3 13.4 19.7 30.5 19.7 51.4 0 73.7-44.9 89.9-87.7 94.6 6.9 5.9 13 17.6 13 35.5 0 25.6-.2 46.3-.2 52.6 0 5.1 3.5 11.1 13.2 9.2 76.2-25.5 131.2-97.3 131.2-182 0-105.9-86-191.7-192-191.7z"/></svg>
				<span>GitHub</span>
			</a>
		</div>
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="Email" href="mailto:blogwimwauters%20at%20gmail.com">
				<svg class="widget-social__link-icon icon icon-mail" width="24" height="24" viewBox="0 0 416 288"><path d="m0 16v256 16h16 384 16v-16-256-16h-16-384-16zm347 16-139 92.5-139-92.5zm-148 125.5 9 5.5 9-5.5 167-111.5v210h-352v-210z"/></svg>
				<span>blogwimwauters at gmail.com</span>
			</a>
		</div>

		
	</div>
</div>
</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2020 Wim Wauters.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>